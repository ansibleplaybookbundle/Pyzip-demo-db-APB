FROM ansibleplaybookbundle/apb-base
# MAINTAINER {{ $MAINTAINER }}

LABEL "com.redhat.apb.version"="0.1.0"
LABEL "com.redhat.apb.spec"=\
"aWQ6IDNlYTRiNTk0LTA4ZmUtNDIxZC1iZDBjLTlmMGJhMzc4NDg4MwpuYW1lOiBweXppcC1kZW1v\
LWRiLWFwYgppbWFnZTogYW5zaWJsZXBsYXlib29rYnVuZGxlL3B5emlwLWRlbW8tZGItYXBiCmRl\
c2NyaXB0aW9uOiBQeXRob24gWmlwIERlbW8gRGF0YWJhc2UgQVBCIEltcGxlbWVudGF0aW9uCmJp\
bmRhYmxlOiBUcnVlCmFzeW5jOiBvcHRpb25hbAptZXRhZGF0YToKICBkb2N1bWVudGF0aW9uVXJs\
OiBodHRwczovL2dpdGh1Yi5jb20vZnVzb3IvYXBiLWV4YW1wbGVzL3RyZWUvbWFzdGVyL3B5emlw\
LWRlbW8tZGItYXBiCiAgZGVwZW5kZW5jaWVzOiBbJ2RvY2tlci5pby9mYWJpYW52Zi9wb3N0Z3Jl\
c3FsOnBvc3RnaXMnXQogIGRpc3BsYXlOYW1lOiBQeXppcCBEZW1vIERhdGFiYXNlIChBUEIpCiAg\
bG9uZ0Rlc2NyaXB0aW9uOiBBIGRhdGFiYXNlIHdpdGggR0lTIHN1cHBvcnQgYW5kIHNlZWRlZCBk\
YXRhIGZvciBhIGRlbW9uc3RyYXRpb24gcHl0aG9uIHdlYmFwcCwgaHR0cHM6Ly9naXRodWIuY29t\
L2Z1c29yL3B5LXppcC1kZW1vCnBsYW5zOgogIC0gbmFtZTogZGVmYXVsdAogICAgZGVzY3JpcHRp\
b246IFRoaXMgcGxhbiBkZXBsb3lzIGEgREIgdG8gYmUgdXNlZCB3aXRoIHRoZSBweXppcC1kZW1v\
IEFQQgogICAgZnJlZTogVHJ1ZQogICAgbWV0YWRhdGE6CiAgICAgIGRpc3BsYXlOYW1lOiBEZWZh\
dWx0CiAgICAgIGNvc3Q6ICQwLjAwCiAgICBwYXJhbWV0ZXJzOgogICAgICAtIG5hbWU6IGRhdGFi\
YXNlX25hbWUKICAgICAgICBkZWZhdWx0OiBhZG1pbgogICAgICAgIHR5cGU6IHN0cmluZwogICAg\
ICAgIHRpdGxlOiBEYXRhYmFzZSBOYW1lCiAgICAgICAgcmVxdWlyZWQ6IFRydWUKICAgICAgLSBu\
YW1lOiBkYXRhYmFzZV9wYXNzd29yZAogICAgICAgIGRlZmF1bHQ6IGFkbWluCiAgICAgICAgdHlw\
ZTogc3RyaW5nCiAgICAgICAgZGVzY3JpcHRpb246IEEgcmFuZG9tIGFscGhhbnVtZXJpYyBzdHJp\
bmcgaWYgbGVmdCBibGFuawogICAgICAgIHRpdGxlOiBEYXRhYmFzZSBQYXNzd29yZAogICAgICAt\
IG5hbWU6IGRhdGFiYXNlX3VzZXIKICAgICAgICBkZWZhdWx0OiBhZG1pbgogICAgICAgIHRpdGxl\
OiBEYXRhYmFzZSBVc2VyCiAgICAgICAgdHlwZTogc3RyaW5nCiAgICAgICAgbWF4bGVuZ3RoOiA2\
MwogICAgICAgIHJlcXVpcmVkOiBUcnVlCg=="

COPY roles /opt/ansible/roles
COPY playbooks /opt/apb/actions
RUN chmod -R g=u /opt/{ansible,apb}

RUN yum install -y postgresql && yum clean all

USER apb
