FROM ansibleplaybookbundle/apb-base
# MAINTAINER {{ $MAINTAINER }}

LABEL "com.redhat.apb.spec"=\
"dmVyc2lvbjogMS4wLjAKbmFtZTogcHl6aXAtZGVtby1kYi1hcGIKZGVzY3JpcHRpb246IFB5dGhv\
biBaaXAgRGVtbyBEYXRhYmFzZSBBUEIgSW1wbGVtZW50YXRpb24KYmluZGFibGU6IFRydWUKYXN5\
bmM6IG9wdGlvbmFsCm1ldGFkYXRhOgogIGRvY3VtZW50YXRpb25Vcmw6IGh0dHBzOi8vZ2l0aHVi\
LmNvbS9mdXNvci9hcGItZXhhbXBsZXMvdHJlZS9tYXN0ZXIvcHl6aXAtZGVtby1kYi1hcGIKICBk\
ZXBlbmRlbmNpZXM6IFsnZG9ja2VyLmlvL2ZhYmlhbnZmL3Bvc3RncmVzcWw6cG9zdGdpcyddCiAg\
ZGlzcGxheU5hbWU6IFB5emlwIERlbW8gRGF0YWJhc2UgKEFQQikKICBsb25nRGVzY3JpcHRpb246\
IEEgZGF0YWJhc2Ugd2l0aCBHSVMgc3VwcG9ydCBhbmQgc2VlZGVkIGRhdGEgZm9yIGEgZGVtb25z\
dHJhdGlvbiBweXRob24gd2ViYXBwLCBodHRwczovL2dpdGh1Yi5jb20vZnVzb3IvcHktemlwLWRl\
bW8KICBwcm92aWRlckRpc3BsYXlOYW1lOiAiUmVkIEhhdCwgSW5jLiIKcGxhbnM6CiAgLSBuYW1l\
OiBkZWZhdWx0CiAgICBkZXNjcmlwdGlvbjogVGhpcyBwbGFuIGRlcGxveXMgYSBEQiB0byBiZSB1\
c2VkIHdpdGggdGhlIHB5emlwLWRlbW8gQVBCCiAgICBmcmVlOiBUcnVlCiAgICBtZXRhZGF0YToK\
ICAgICAgZGlzcGxheU5hbWU6IERlZmF1bHQKICAgICAgY29zdDogJDAuMDAKICAgIHBhcmFtZXRl\
cnM6CiAgICAgIC0gbmFtZTogZGF0YWJhc2VfbmFtZQogICAgICAgIGRlZmF1bHQ6IGFkbWluCiAg\
ICAgICAgdHlwZTogc3RyaW5nCiAgICAgICAgdGl0bGU6IERhdGFiYXNlIE5hbWUKICAgICAgICBy\
ZXF1aXJlZDogVHJ1ZQogICAgICAtIG5hbWU6IGRhdGFiYXNlX3Bhc3N3b3JkCiAgICAgICAgZGVm\
YXVsdDogYWRtaW4KICAgICAgICB0eXBlOiBzdHJpbmcKICAgICAgICBkZXNjcmlwdGlvbjogQSBy\
YW5kb20gYWxwaGFudW1lcmljIHN0cmluZyBpZiBsZWZ0IGJsYW5rCiAgICAgICAgdGl0bGU6IERh\
dGFiYXNlIFBhc3N3b3JkCiAgICAgIC0gbmFtZTogZGF0YWJhc2VfdXNlcgogICAgICAgIGRlZmF1\
bHQ6IGFkbWluCiAgICAgICAgdGl0bGU6IERhdGFiYXNlIFVzZXIKICAgICAgICB0eXBlOiBzdHJp\
bmcKICAgICAgICBtYXhsZW5ndGg6IDYzCiAgICAgICAgcmVxdWlyZWQ6IFRydWUK"

COPY roles /opt/ansible/roles
COPY playbooks /opt/apb/actions
RUN chmod -R g=u /opt/{ansible,apb}

RUN yum install -y postgresql && yum clean all

USER apb
