FROM ansibleplaybookbundle/apb-base
# MAINTAINER {{ $MAINTAINER }}

LABEL "com.redhat.apb.spec"=\
"dmVyc2lvbjogMS4wCm5hbWU6IHB5emlwLWRlbW8tZGItYXBiCmltYWdlOiBhbnNpYmxlcGxheWJv\
b2tidW5kbGUvcHl6aXAtZGVtby1kYi1hcGIKZGVzY3JpcHRpb246IFB5dGhvbiBaaXAgRGVtbyBE\
YXRhYmFzZSBBUEIgSW1wbGVtZW50YXRpb24KYmluZGFibGU6IFRydWUKYXN5bmM6IG9wdGlvbmFs\
Cm1ldGFkYXRhOgogIGRvY3VtZW50YXRpb25Vcmw6IGh0dHBzOi8vZ2l0aHViLmNvbS9mdXNvci9h\
cGItZXhhbXBsZXMvdHJlZS9tYXN0ZXIvcHl6aXAtZGVtby1kYi1hcGIKICBkZXBlbmRlbmNpZXM6\
IFsnZG9ja2VyLmlvL2ZhYmlhbnZmL3Bvc3RncmVzcWw6cG9zdGdpcyddCiAgZGlzcGxheU5hbWU6\
IFB5emlwIERlbW8gRGF0YWJhc2UgKEFQQikKICBsb25nRGVzY3JpcHRpb246IEEgZGF0YWJhc2Ug\
d2l0aCBHSVMgc3VwcG9ydCBhbmQgc2VlZGVkIGRhdGEgZm9yIGEgZGVtb25zdHJhdGlvbiBweXRo\
b24gd2ViYXBwLCBodHRwczovL2dpdGh1Yi5jb20vZnVzb3IvcHktemlwLWRlbW8KICBwcm92aWRl\
ckRpc3BsYXlOYW1lOiAiUmVkIEhhdCwgSW5jLiIKcGxhbnM6CiAgLSBuYW1lOiBkZWZhdWx0CiAg\
ICBkZXNjcmlwdGlvbjogVGhpcyBwbGFuIGRlcGxveXMgYSBEQiB0byBiZSB1c2VkIHdpdGggdGhl\
IHB5emlwLWRlbW8gQVBCCiAgICBmcmVlOiBUcnVlCiAgICBtZXRhZGF0YToKICAgICAgZGlzcGxh\
eU5hbWU6IERlZmF1bHQKICAgICAgY29zdDogJDAuMDAKICAgIHBhcmFtZXRlcnM6CiAgICAgIC0g\
bmFtZTogZGF0YWJhc2VfbmFtZQogICAgICAgIGRlZmF1bHQ6IGFkbWluCiAgICAgICAgdHlwZTog\
c3RyaW5nCiAgICAgICAgdGl0bGU6IERhdGFiYXNlIE5hbWUKICAgICAgICByZXF1aXJlZDogVHJ1\
ZQogICAgICAtIG5hbWU6IGRhdGFiYXNlX3Bhc3N3b3JkCiAgICAgICAgZGVmYXVsdDogYWRtaW4K\
ICAgICAgICB0eXBlOiBzdHJpbmcKICAgICAgICBkZXNjcmlwdGlvbjogQSByYW5kb20gYWxwaGFu\
dW1lcmljIHN0cmluZyBpZiBsZWZ0IGJsYW5rCiAgICAgICAgdGl0bGU6IERhdGFiYXNlIFBhc3N3\
b3JkCiAgICAgIC0gbmFtZTogZGF0YWJhc2VfdXNlcgogICAgICAgIGRlZmF1bHQ6IGFkbWluCiAg\
ICAgICAgdGl0bGU6IERhdGFiYXNlIFVzZXIKICAgICAgICB0eXBlOiBzdHJpbmcKICAgICAgICBt\
YXhsZW5ndGg6IDYzCiAgICAgICAgcmVxdWlyZWQ6IFRydWUK"

COPY roles /opt/ansible/roles
COPY playbooks /opt/apb/actions
RUN chmod -R g=u /opt/{ansible,apb}

RUN yum install -y postgresql && yum clean all

USER apb
